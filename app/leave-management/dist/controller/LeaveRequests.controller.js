sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/UIComponent","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,o,r,s){"use strict";return e.extend("leave.management.controller.LeaveRequests",{onInit:function(){this._oRouter=o.getRouterFor(this);this._oRouter.attachRouteMatched(this.onRouteMatched,this);this.getView().setModel(new s({busy:false,delay:0}),"viewModel")},formatDate:function(e){if(!e)return"";var t=new Date(e);if(isNaN(t))return"";var o=t.getDate().toString().padStart(2,"0");var r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var s=r[t.getMonth()];var n=t.getFullYear();return`${o}-${s}-${n}`},onRouteMatched:function(e){var t=e.getParameter("name");if(t==="leaveRequests"){this._loadLeaveRequests()}},_loadLeaveRequests:async function(){try{const e=this.getView().getModel("viewModel");e.setProperty("/busy",true);const t=this.byId("leaveRequestsTable");const o=t.getBinding("items");if(o){o.attachEventOnce("dataReceived",()=>{e.setProperty("/busy",false)});await o.refresh()}}catch(e){r.error("Error loading leave requests: "+e.message);this.getView().getModel("viewModel").setProperty("/busy",false)}},formatStatusState:function(e){switch(e){case"Approved":return"Success";case"Rejected":return"Error";case"Pending":return"Warning";case"Cancelled":return"Information";default:return"None"}},onApproveRequest:function(e){var t=e.getSource().getBindingContext();var o=t.getObject();this._callAction(o.ID,"approveRequest","Leave request approved successfully")},onRejectRequest:function(e){var t=e.getSource().getBindingContext();var o=t.getObject();this._callAction(o.ID,"rejectRequest","Leave request rejected successfully")},_callAction:function(e,t,o){var s=this.getView().getModel();var n="/LeaveRequests("+e+")/"+t;s.callFunction(n,{method:"POST",success:function(){r.success(o);this._loadLeaveRequests()}.bind(this),error:function(e){r.error("Error: "+e.message)}})},onCreateLeaveRequest:function(){this._oRouter.navTo("createLeaveRequest")},onNavBack:function(){var e=o.getRouterFor(this);if(e){e.navTo("home",{},true)}else{window.location.href="/"}},onCancelLeaveRequest:function(e){const t=e.getSource().getBindingContext();const o=t.getObject();r.confirm("Are you sure you want to cancel this leave request?",{title:"Cancel Leave Request",actions:[r.Action.YES,r.Action.NO],emphasizedAction:r.Action.YES,onClose:async e=>{if(e===r.Action.YES){try{const e=this.getView().getModel();const t=e.bindContext(`/LeaveRequests(ID=${o.ID})/LeaveService.cancelRequest(...)`);await t.execute();e.refresh();r.success("Leave request cancelled successfully")}catch(e){r.error("Error cancelling leave request: "+e.message);console.error("Error:",e)}}}})}})});
//# sourceMappingURL=LeaveRequests.controller.js.map